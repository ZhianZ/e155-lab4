/*********************************************************************
*                    SEGGER Microcontroller GmbH                     *
*                        The Embedded Experts                        *
**********************************************************************

-------------------------- END-OF-HEADER -----------------------------

File    : main.c
Purpose : Generic application start

*/

#include <stdio.h>
#include "GPIO.h"
#include "TIM1516.h"
#include "RCC.h"
#include "STM32L432KC_FLASH.h"

/*********************************************************************
*
*       main()
*
*  Function description
*   Application entry point.
*/

// lab4_starter.c
// Fur Elise, E155 Lab 4
// Updated Fall 2024

// Pitch in Hz, duration in ms
const int notes[][2] = {
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	250},
{  0,	125},
{494,	125},
{523,	125},
{587,	125},
{659,	375},
{392,	125},
{699,	125},
{659,	125},
{587,	375},
{349,	125},
{659,	125},
{587,	125},
{523,	375},
{330,	125},
{587,	125},
{523,	125},
{494,	250},
{  0,	125},
{330,	125},
{659,	125},
{  0,	250},
{659,	125},
{1319,	125},
{  0,	250},
{623,	125},
{659,	125},
{  0,	250},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	500},
{  0,	0}};

// Ode to Joy
const int notes2[][2] = {
    {330, 500},  // E
    {330, 500},  // E
    {349, 500},  // F
    {392, 500},  // G
    {392, 500},  // G
    {349, 500},  // F
    {330, 500},  // E
    {294, 500},  // D
    {262, 500},  // C
    {262, 500},  // C
    {294, 500},  // D
    {330, 500},  // E
    {330, 750},  // E
    {294, 250},  // D
    {294, 1000}, // D
    {330, 500},  // E
    {330, 500},  // E
    {349, 500},  // F
    {392, 500},  // G
    {392, 500},  // G
    {349, 500},  // F
    {330, 500},  // E
    {294, 500},  // D
    {262, 500},  // C
    {262, 500},  // C
    {294, 500},  // D
    {330, 500},  // E
    {294, 750},  // D
    {262, 250},  // C
    {262, 1000}, // C
    {0, 0}       
};



void playMusic() {
    int i = 0;
    while (notes[i][1] != 0) {  // Continue until duration is 0 (end of song)
        setFreq(TIM16, notes[i][0]);  // Set the PWM frequency
        delay_millis(TIM15, notes[i][1]);  // Play for the specified duration
        i++;
    }

    int j = 0;
    while (notes2[j][1] != 0) {  // Continue until duration is 0 (end of song)
        setFreq(TIM16, notes2[j][0]);  // Set the PWM frequency
        delay_millis(TIM15, notes2[j][1]);  // Play for the specified duration
        j++;
    }

}

int main(void) {
    configureFlash();
    configureClock();
    RCC->APB2ENR |= (1<<16); // Enable TIM15
    RCC->APB2ENR |= (1<<17); // Enable TIM16

    initTIM(TIM15); // Initialize Timer 15
    initPWM(TIM16); // Initialize timer 16 PWM mode
    
    RCC->AHB2ENR |= (1<<0); // IO port A Enable
    pinMode(6, GPIO_ALT); // Set PA6 as output
    GPIO->AFRL |= (0b1110 << 24); // AF14

    while(1){
        playMusic();
    }
  
}
/*************************** End of file ****************************/
